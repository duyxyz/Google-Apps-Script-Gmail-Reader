<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>·ª®ng d·ª•ng ƒë·ªçc Gmail</title>
  <style>
    body {
      font-family: Roboto, Arial, sans-serif; /* Th·ª≠ d√πng font Roboto n·∫øu c√≥ */
      margin: 0;
      padding: 0;
      background-color: #f6f8fa; /* N·ªÅn nh·∫π nh√†ng h∆°n */
      display: flex;
      flex-direction: column;
      min-height: 100vh; /* Full viewport height */
      color: #3c4043; /* M√†u ch·ªØ m·∫∑c ƒë·ªãnh c·ªßa Gmail */
    }
    .container {
      max-width: 100%; /* S·ª≠ d·ª•ng to√†n b·ªô chi·ªÅu r·ªông c√≥ th·ªÉ */
      margin: 0; /* Lo·∫°i b·ªè margin tr√™n c√πng/d∆∞·ªõi c√πng ƒë·ªÉ tr√†n vi·ªÅn h∆°n */
      padding: 20px;
      background-color: #fff;
      border-radius: 0; /* B·ªè border-radius */
      box-shadow: none; /* B·ªè box-shadow */
      flex-grow: 1;
      box-sizing: border-box; /* Bao g·ªìm padding v√† border trong width/height */
      padding-left: 20px; /* Th√™m kho·∫£ng tr·ªëng hai b√™n */
      padding-right: 20px;
    }
    @media (min-width: 768px) {
      .container {
        padding: 20px 40px; /* TƒÉng padding ngang tr√™n m√†n h√¨nh l·ªõn */
      }
    }
    @media (min-width: 1024px) {
      .container {
        padding-left: 50px; /* Th√™m kho·∫£ng tr·ªëng hai b√™n */
        padding-right: 50px;
      }
    }
    @media (min-width: 1200px) {
      .container {
        max-width: 1200px; /* Gi·ªõi h·∫°n ƒë·ªô r·ªông t·ªëi ƒëa tr√™n m√†n h√¨nh r·∫•t l·ªõn */
        margin: 0 auto; /* CƒÉn gi·ªØa l·∫°i */
      }
    }

    /* Login Page */
    #login-page {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-grow: 1;
      background-color: #f6f8fa; /* N·ªÅn nh·∫π nh√†ng cho trang login */
      opacity: 0; /* Ban ƒë·∫ßu ·∫©n ƒë·ªÉ chu·∫©n b·ªã cho animation */
      transform: translateY(10px); /* B·∫Øt ƒë·∫ßu d·ªãch chuy·ªÉn */
    }
    .login-box {
      background-color: #fff;
      padding: 30px;
      border-radius: 0; /* B·ªè border-radius */
      box-shadow: none; /* B·ªè box-shadow */
      text-align: center;
      width: 100%;
      max-width: 400px;
    }
    .login-box h2 {
      margin-bottom: 20px;
      color: #333;
    }
    .login-box input[type="password"] {
      width: calc(100% - 20px);
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid #ddd;
      border-radius: 0; /* B·ªè border-radius */
    }
    .login-box button {
      background-color: white; /* M√†u n·ªÅn tr·∫Øng */
      color: #1a73e8; /* M√†u ch·ªØ xanh */
      border: 1px solid #1a73e8; /* Vi·ªÅn xanh */
      height: 40px; /* Chi·ªÅu cao c·ªë ƒë·ªãnh cho n√∫t */
      border-radius: 0; /* B·ªè border-radius */
      cursor: pointer;
      width: 100%;
      font-size: 16px;
      display: flex; /* D√πng flexbox ƒë·ªÉ cƒÉn ch·ªânh n·ªôi dung */
      align-items: center; /* CƒÉn gi·ªØa theo chi·ªÅu d·ªçc */
      justify-content: center; /* CƒÉn gi·ªØa theo chi·ªÅu ngang */
      min-width: 120px; /* ƒê·∫£m b·∫£o k√≠ch th∆∞·ªõc t·ªëi thi·ªÉu cho n√∫t */
      box-sizing: border-box;
      /* ƒê√£ lo·∫°i b·ªè hi·ªáu ·ª©ng hover t·∫°i ƒë√¢y */
    }
    .login-box button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }
    .error-msg {
      color: #d93025; /* M√†u l·ªói c·ªßa Google */
      margin-top: 10px;
      display: none;
    }
    /* Main Page */
    #main-page {
      display: none;
      flex-grow: 1;
      opacity: 0; /* Ban ƒë·∫ßu ·∫©n ƒë·ªÉ chu·∫©n b·ªã cho animation */
      transform: translateY(10px); /* B·∫Øt ƒë·∫ßu d·ªãch chuy·ªÉn */
    }
    .tab-buttons {
      display: flex;
      margin-bottom: 15px;
      border-bottom: 1px solid #dadce0; /* ƒê∆∞·ªùng k·∫ª d∆∞·ªõi tab */
    }
    .tab-buttons button {
      background-color: transparent;
      border: none;
      padding: 10px 15px;
      cursor: pointer;
      font-size: 15px;
      color: #5f6368;
      position: relative;
      outline: none;
    }
    .tab-buttons button.active {
      color: #1a73e8; /* M√†u tab active c·ªßa Google */
      font-weight: 500;
    }
    .tab-buttons button.active::after {
      content: '';
      position: absolute;
      bottom: -1px; /* ƒê·∫∑t d∆∞·ªõi ƒë∆∞·ªùng k·∫ª */
      left: 0;
      width: 100%;
      height: 2px;
      background-color: #1a73e8; /* ƒê∆∞·ªùng k·∫ª d∆∞·ªõi tab active */
    }
    .tab-buttons button.active-spam {
      color: #d93025; /* M√†u ƒë·ªè cho spam */
    }
    .tab-buttons button.active-spam::after {
      background-color: #d93025;
    }

    .controls {
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 10px;
      padding: 10px 0;
      border-bottom: 1px solid #dadce0; /* ƒê∆∞·ªùng k·∫ª d∆∞·ªõi controls */
    }
    .controls label {
      color: #5f6368;
    }
    .controls input[type="number"] {
      width: 60px; /* C·ªë ƒë·ªãnh chi·ªÅu r·ªông */
      height: 30px; /* Chi·ªÅu cao c·ªë ƒë·ªãnh */
      padding: 0 5px; /* ƒêi·ªÅu ch·ªânh padding */
      border: 1px solid #dadce0;
      border-radius: 0; /* B·ªè border-radius */
      text-align: center;
      box-sizing: border-box; /* T√≠nh border v√† padding v√†o k√≠ch th∆∞·ªõc */
    }
    .controls button {
      background-color: white; /* M√†u n·ªÅn tr·∫Øng */
      color: #1a73e8; /* M√†u ch·ªØ xanh */
      border: 1px solid #1a73e8; /* Vi·ªÅn xanh */
      height: 32px; /* Chi·ªÅu cao c·ªë ƒë·ªãnh cho n√∫t, l·ªõn h∆°n input m·ªôt ch√∫t ƒë·ªÉ cƒÉn ch·ªânh */
      border-radius: 0; /* B·ªè border-radius */
      cursor: pointer;
      font-size: 14px;
      display: flex; /* D√πng flexbox ƒë·ªÉ cƒÉn ch·ªânh n·ªôi dung */
      align-items: center; /* CƒÉn gi·ªØa theo chi·ªÅu d·ªçc */
      justify-content: center; /* CƒÉn gi·ªØa theo chi·ªÅu ngang */
      min-width: 120px; /* ƒê·∫£m b·∫£o k√≠ch th∆∞·ªõc t·ªëi thi·ªÉu cho n√∫t */
      box-sizing: border-box;
      /* ƒê√£ lo·∫°i b·ªè hi·ªáu ·ª©ng hover t·∫°i ƒë√¢y */
    }
    .controls button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }

    /* Email List Styling */
    .email-list {
        background-color: #fff;
        border: 1px solid #dadce0; /* Gi·ªØ border ƒë·ªÉ ph√¢n bi·ªát danh s√°ch */
        border-radius: 0; /* B·ªè border-radius */
        overflow: hidden;
        margin-top: 15px;
    }
    .email-row {
      display: grid;
      /* ƒêi·ªÅu ch·ªânh grid-template-columns ƒë·ªÉ c√¢n ƒë·ªëi h∆°n tr√™n c√°c m√†n h√¨nh */
      grid-template-columns: minmax(100px, 200px) 1fr minmax(80px, 120px); /* From, Subject/Snippet, Date */
      align-items: center; /* CƒÉn gi·ªØa theo chi·ªÅu d·ªçc */
      padding: 12px 20px;
      border-bottom: 1px solid #e8eaed; /* ƒê∆∞·ªùng k·∫ª gi·ªØa c√°c email */
      cursor: pointer;
      position: relative;
    }
    .email-row:last-child {
      border-bottom: none; /* Kh√¥ng c√≥ ƒë∆∞·ªùng k·∫ª ·ªü email cu·ªëi c√πng */
    }
    .email-row:hover {
      background-color: #f5f5f5; /* M√†u n·ªÅn khi hover */
    }

    .email-row .from {
      font-weight: 700; /* Ng∆∞·ªùi g·ª≠i ƒë·∫≠m */
      color: #202124;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      padding-right: 10px;
    }
    .email-row .content-wrapper { /* Wrapper cho subject v√† snippet */
        display: flex;
        flex-grow: 1;
        min-width: 0; /* Cho ph√©p co l·∫°i */
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    .email-row .subject {
      font-weight: 500; /* Ch·ªß ƒë·ªÅ ƒë·∫≠m v·ª´a */
      color: #202124;
      /* Kh√¥ng c·∫ßn overflow/text-overflow ·ªü ƒë√¢y n·∫øu wrapper ƒë√£ x·ª≠ l√Ω */
      flex-shrink: 0; /* ƒê·∫£m b·∫£o ch·ªß ƒë·ªÅ kh√¥ng b·ªã co qu√° m·ª©c */
    }
    .email-row .snippet {
      color: #5f6368;
      margin-left: 5px; /* Kho·∫£ng c√°ch gi·ªØa subject v√† snippet */
      /* Ph·∫ßn c√≤n l·∫°i c·ªßa overflow/text-overflow s·∫Ω do content-wrapper x·ª≠ l√Ω */
    }
    .email-row .date {
      color: #5f6368;
      font-size: 0.85em;
      white-space: nowrap;
      text-align: right;
    }

    .email-row.unread {
      background-color: #fff; /* Email ch∆∞a ƒë·ªçc v·∫´n n·ªÅn tr·∫Øng */
      font-weight: 700; /* To√†n b·ªô h√†ng ch∆∞a ƒë·ªçc s·∫Ω ƒë·∫≠m */
    }
    .email-row.unread .from,
    .email-row.unread .subject,
    .email-row.unread .snippet,
    .email-row.unread .date {
        font-weight: 700; /* ƒê·∫≠m cho t·ª´ng ph·∫ßn c·ªßa email ch∆∞a ƒë·ªçc */
        color: #202124;
    }

    .tab-content { display: none; }
    .tab-content.active { display: block; }

    /* Popup */
    .popup {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.6);
      z-index: 100;
      justify-content: center;
      align-items: center;
      opacity: 0; /* Ban ƒë·∫ßu ·∫©n ƒë·ªÉ chu·∫©n b·ªã cho animation */
      transform: translateY(10px); /* B·∫Øt ƒë·∫ßu d·ªãch chuy·ªÉn */
    }
    .popup-content {
  background: #fff;
  padding: 20px;
  border-radius: 0;
  box-shadow: none;
  position: relative;
  width: 90%;
  max-width: 700px;
  max-height: 90vh;
  overflow-y: auto;

  /* ·∫®n thanh cu·ªôn cho WebKit browsers (Chrome, Safari) */
  &::-webkit-scrollbar {
    display: none;
  }

  /* ·∫®n thanh cu·ªôn cho Firefox */
  scrollbar-width: none; /* ·∫®n thanh cu·ªôn */

  /* ·∫®n thanh cu·ªôn cho Microsoft Edge (v√† IE) */
  -ms-overflow-style: none; /* ·∫®n thanh cu·ªôn */
}
    .email-body { margin-top: 20px; }
    .pagination-controls {
        display: none; /* B·ªè ph√¢n trang */
    }

    /* Animation cho trang */
    .fade-in {
      animation: fadeIn 0.5s ease-in-out forwards;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .flex-center { display: flex; align-items: center; justify-content: center; gap: 5px; }
    .hidden { display: none; }
    .switch { position: relative; display: inline-block; width: 40px; height: 20px; }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; -webkit-transition: .4s; transition: .4s; border-radius: 20px; }
    .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 2px; bottom: 2px; background-color: white; -webkit-transition: .4s; transition: .4s; border-radius: 50%; }
    input:checked + .slider { background-color: #1a73e8; } /* M√†u xanh Google */
    input:checked + .slider:before { -webkit-transform: translateX(20px); -ms-transform: translateX(20px); transform: translateX(20px); }

    /* Footer */
    footer {
        background-color: #f6f8fa; /* N·ªÅn nh·∫π nh√†ng h∆°n */
        color: #5f6368; /* M√†u ch·ªØ x√°m */
        text-align: center;
        padding: 15px 0;
        margin-top: 20px;
        border-top: 1px solid #dadce0;
    }
  </style>
</head>
<body>
  <div id="login-page">
    <div class="login-box">
      <h2>üîê ƒêƒÉng nh·∫≠p</h2>
      <div>
        <label>M√£ PIN</label>
        <input type="password" id="pin" autofocus>
      </div>
      <button id="login-btn" onclick="login()">
        <span id="login-text">ƒêƒÉng nh·∫≠p</span>
      </button>
      <p id="error" class="error-msg">M√£ PIN kh√¥ng ƒë√∫ng!</p>
    </div>
  </div>

  <div id="main-page" class="hidden container">
    <div class="tab-buttons">
      <button onclick="showTab('inbox', event)" class="active">H√≤m th∆∞</button>
      <button onclick="showTab('spam', event)">Th∆∞ r√°c</button>
    </div>

    <div class="controls">
      <label>
        T·ª± ƒë·ªông t·∫£i l·∫°i m·ªói 10 gi√¢y
        <label class="switch">
          <input type="checkbox" id="auto-reload-toggle">
          <span class="slider"></span>
        </label>
      </label>

      <div class="flex-center">
        <label>S·ªë email:</label>
        <input type="number" id="email-limit" min="1" max="50" value="10">
        <button id="reload-btn" onclick="manualReload()">
          <span id="reload-text">T·∫£i l·∫°i mail</span>
        </button>
      </div>
    </div>

    <div id="inbox" class="tab-content active email-list">
      <div id="inbox-list"></div>
    </div>

    <div id="spam" class="tab-content email-list">
      <div id="spam-list"></div>
    </div>

    <div id="pagination-controls"></div>
  </div>

  <div id="email-popup" class="popup">
    <div class="popup-content">
      <div id="email-content" class="email-body"></div>
    </div>
  </div>

  <footer>
    <p>·ª®ng d·ª•ng ƒë·ªçc Gmail - Ph√°t tri·ªÉn b·ªüi <strong>Nguy·ªÖn Minh Duy</strong></p>
    <p>¬© <span id="current-year"></span>. All rights reserved.</p>
  </footer>

  <script>
    let currentTab = 'inbox';
    let inboxEmails = [], spamEmails = [];
    let currentPage = 1;
    const pageSize = 50;
    let autoReloadInterval = null;

    async function login(event) {
      if (event && event.key === 'Enter') event.preventDefault();
      const btn = document.getElementById('login-btn');
      // const spinner = document.getElementById('login-spinner'); // ƒê√£ x√≥a
      const text = document.getElementById('login-text');
      const error = document.getElementById('error');

      // spinner.style.display = 'inline-block'; // ƒê√£ x√≥a
      text.textContent = 'ƒêang ƒëƒÉng nh·∫≠p...';
      btn.disabled = true;

      try {
        const pin = document.getElementById('pin').value;
        const isValid = await new Promise(resolve => google.script.run.withSuccessHandler(resolve).validatePin(pin));
        if (isValid) {
          const expiryDays = await new Promise(resolve => google.script.run.withSuccessHandler(resolve).getPinExpiryDays());
          const expiry = new Date();
          expiry.setDate(expiry.getDate() + expiryDays);
          localStorage.setItem('pin', pin);
          localStorage.setItem('pinExpiry', expiry.getTime());
          showMainPage();
        } else {
          error.style.display = 'block';
        }
      } catch (e) {
        error.textContent = 'ƒê√£ x·∫£y ra l·ªói: ' + e.message;
        error.style.display = 'block';
      } finally {
        // spinner.style.display = 'none'; // ƒê√£ x√≥a
        text.textContent = 'ƒêƒÉng nh·∫≠p';
        btn.disabled = false;
      }
    }

    function checkAutoLogin() {
      const saved = localStorage.getItem('pin');
      const expiry = localStorage.getItem('pinExpiry');
      if (saved && Date.now() < parseInt(expiry)) {
        google.script.run.withSuccessHandler(isValid => {
          if (isValid) {
            document.getElementById('login-page').style.display = 'none';
            document.getElementById('main-page').style.display = 'block';
            document.getElementById('main-page').classList.add('fade-in'); // Th√™m animation
            manualReload();
          }
        }).validatePin(saved);
      }
    }

    async function showMainPage() {
      document.getElementById('login-page').style.display = 'none';
      document.getElementById('main-page').style.display = 'block';
      document.getElementById('main-page').classList.add('fade-in'); // Th√™m animation
      await manualReload();
    }

    async function manualReload() {
      const btn = document.getElementById('reload-btn');
      // const spinner = document.getElementById('reload-spinner'); // ƒê√£ x√≥a
      const text = document.getElementById('reload-text');
      // spinner.style.display = 'inline-block'; // ƒê√£ x√≥a
      text.textContent = 'ƒêang t·∫£i mail...';
      btn.disabled = true; // Disable reload button during loading
      await loadAllEmails();
      (currentTab === 'inbox') ? loadEmails() : loadSpamEmails();
      // spinner.style.display = 'none'; // ƒê√£ x√≥a
      text.textContent = 'T·∫£i l·∫°i mail';
      btn.disabled = false; // Enable reload button after loading
    }

    async function loadAllEmails() {
      const limit = parseInt(document.getElementById('email-limit').value) || 10;
      inboxEmails = await new Promise(resolve => google.script.run.withSuccessHandler(resolve).getAllEmailsWithHtml(limit));
      spamEmails = await new Promise(resolve => google.script.run.withSuccessHandler(resolve).getAllSpamEmailsWithHtml(limit));
    }

    function showTab(tab, event) {
      currentTab = tab;
      currentPage = 1;
      document.querySelectorAll('.tab-content').forEach(el => el.style.display = 'none');
      document.getElementById(tab).style.display = 'block';

      document.querySelectorAll('.tab-buttons button').forEach(btn => {
        btn.classList.remove('active', 'active-spam');
      });

      if (tab === 'inbox') {
        event.target.classList.add('active');
        loadEmails();
      } else {
        event.target.classList.add('active-spam');
        loadSpamEmails();
      }
    }

    // Function paginate v√† renderPagination kh√¥ng c√≤n ƒë∆∞·ª£c s·ª≠ d·ª•ng nh∆∞ng gi·ªØ l·∫°i ph√≤ng khi c·∫ßn
    function paginate(arr, page) {
      return arr.slice((page - 1) * pageSize, page * pageSize);
    }

    function renderPagination(total) {
      const totalPages = Math.ceil(total / pageSize);
      const container = document.getElementById('pagination-controls');
      container.innerHTML = '';
      for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement('button');
        btn.textContent = i;
        btn.className = `pagination-btn ${i === currentPage ? 'active' : ''}`;
        btn.onclick = () => {
          currentPage = i;
          currentTab === 'inbox' ? loadEmails() : loadSpamEmails();
        };
        container.appendChild(btn);
      }
    }

    function loadEmails() {
      const listContainer = document.getElementById('inbox-list');
      listContainer.innerHTML = ''; // Clear previous emails
      const pageEmails = paginate(inboxEmails, currentPage); // V·∫´n g·ªçi paginate nh∆∞ng ch·ªâ c√≥ 1 trang
      pageEmails.forEach(email => {
        const row = document.createElement('div'); // Using div instead of tr
        row.className = `email-row ${email.isUnread ? 'unread' : ''}`;
        row.onclick = () => showEmailPopup(email);

        // Create individual spans for better styling control
        const fromSpan = document.createElement('span');
        fromSpan.className = 'from';
        fromSpan.textContent = email.from.split('<')[0].trim(); // Get name only
        row.appendChild(fromSpan);

        const contentWrapper = document.createElement('div'); // Wrapper for subject and snippet
        contentWrapper.className = 'content-wrapper';
        
        const subjectSpan = document.createElement('span');
        subjectSpan.className = 'subject';
        subjectSpan.textContent = email.subject;
        contentWrapper.appendChild(subjectSpan);

        const snippetSpan = document.createElement('span');
        snippetSpan.className = 'snippet';
        snippetSpan.textContent = ` - ${email.snippet}`; // Add a separator
        contentWrapper.appendChild(snippetSpan);

        row.appendChild(contentWrapper);

        const dateSpan = document.createElement('span');
        dateSpan.className = 'date';
        dateSpan.textContent = email.date;
        row.appendChild(dateSpan);

        listContainer.appendChild(row);
      });
      // renderPagination(inboxEmails.length); // B·ªè renderPagination
    }

    function loadSpamEmails() {
      const listContainer = document.getElementById('spam-list');
      listContainer.innerHTML = ''; // Clear previous emails
      const pageEmails = paginate(spamEmails, currentPage); // V·∫´n g·ªçi paginate nh∆∞ng ch·ªâ c√≥ 1 trang
      pageEmails.forEach(email => {
        const row = document.createElement('div'); // Using div instead of tr
        row.className = `email-row ${email.isUnread ? 'unread' : ''}`;
        row.onclick = () => showEmailPopup(email);

        const fromSpan = document.createElement('span');
        fromSpan.className = 'from';
        fromSpan.textContent = email.from.split('<')[0].trim();
        row.appendChild(fromSpan);

        const contentWrapper = document.createElement('div');
        contentWrapper.className = 'content-wrapper';

        const subjectSpan = document.createElement('span');
        subjectSpan.className = 'subject';
        subjectSpan.textContent = email.subject;
        contentWrapper.appendChild(subjectSpan);

        const snippetSpan = document.createElement('span');
        snippetSpan.className = 'snippet';
        snippetSpan.textContent = ` - ${email.snippet}`;
        contentWrapper.appendChild(snippetSpan);

        row.appendChild(contentWrapper);

        const dateSpan = document.createElement('span');
        dateSpan.className = 'date';
        dateSpan.textContent = email.date;
        row.appendChild(dateSpan);

        listContainer.appendChild(row);
      });
      // renderPagination(spamEmails.length); // B·ªè renderPagination
    }

    async function showEmailPopup(email) {
      const content = document.getElementById('email-content');
      content.innerHTML = email.html || `<div>${email.snippet}</div><p style="font-size: 0.9em; color: #666;">Kh√¥ng t√¨m th·∫•y n·ªôi dung HTML ƒë·∫ßy ƒë·ªß.</p>`;
      document.getElementById('email-popup').style.display = 'flex';
      document.getElementById('email-popup').classList.add('fade-in'); // Th√™m animation
      if (email.isUnread) {
        await new Promise(resolve => google.script.run.withSuccessHandler(resolve).markAsRead(email.id));
        email.isUnread = false;
        // Re-render the current list to update the unread status
        currentTab === 'inbox' ? loadEmails() : loadSpamEmails();
      }
    }

    function closePopup() {
      document.getElementById('email-popup').style.display = 'none';
      document.getElementById('email-popup').classList.remove('fade-in'); // X√≥a animation khi ƒë√≥ng
    }

    document.getElementById('auto-reload-toggle').addEventListener('change', function () {
      localStorage.setItem('autoReload', this.checked);
      if (this.checked) {
        manualReload();
        autoReloadInterval = setInterval(manualReload, 10000);
      } else {
        clearInterval(autoReloadInterval);
      }
    });

    window.onload = () => {
      checkAutoLogin();
      // ƒê·∫£m b·∫£o login-page c√≥ animation n·∫øu n√≥ hi·ªÉn th·ªã ban ƒë·∫ßu
      if (document.getElementById('login-page').style.display !== 'none') {
        document.getElementById('login-page').classList.add('fade-in');
      }

      const saved = localStorage.getItem('autoReload') === 'true';
      document.getElementById('auto-reload-toggle').checked = saved;
      if (saved) autoReloadInterval = setInterval(manualReload, 10000);
      document.getElementById('email-limit').addEventListener('input', () => {
        setTimeout(async () => {
          currentPage = 1;
          await loadAllEmails();
          (currentTab === 'inbox') ? loadEmails() : loadSpamEmails();
        }, 1000);
      });
      document.getElementById('current-year').textContent = new Date().getFullYear();
    };

    document.getElementById('email-popup').addEventListener('click', (event) => {
      if (event.target === document.getElementById('email-popup')) closePopup();
    });

    document.addEventListener('keydown', (event) => {
      if (event.key === 'Enter' && document.getElementById('login-page').style.display !== 'none') login(event);
      else if (event.key === 'Escape') closePopup();
    });
  </script>
</body>
</html>